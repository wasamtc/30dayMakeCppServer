# day03

今天完成的主要是用epoll实现多个客户端访问服务端。

知识：epoll的原理是在内核中保留了一个内核事件表，我们可以通过三个函数（系统调用修改这个表），把相应sockfd和事件放到表中，然后我们就可以用wait函数等待内核事件表中的事件发生，然后把发生的事件存储在参数event中，参数event中的data有fd可以看是哪个socket，有客户端的连接，把客户端的socket和相应的事件添加到内核事件表中即可，这样下次wait的时候也会在一定时间内看相应的事件发生没有，有多少个客户端连接就可以把相应的socket添加到内核事件表中，wait之后得到一定时间内发生的事件，然后循环处理这些事件。

过程：对于客户端，就是客户端去连接服务端，然后不断的写入，读入。对于服务端，监听端口后，创建内核事件表，把服务端的端口添加进去，然后wait，得到事件循环处理，判断事件类型，如果是连接就把得到客户端口并加入内核事件表，如果是写入就读入并写出。

运行服务端，监听，建立内核事务表，wait，客户端运行，connect函数执行，wait得到事件，判断事件得到客户端口加入内核事件表，继续wait，客户端写入信息，服务端得到事件，输出读入，并写回。

如果先运行客户端，connect函数很快就会返回（返回-1），所以不行。